<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Food Safety Checker</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0f1117;--surface:#1a1d27;--surface2:#242734;--surface3:#2e3244;
    --text:#e8eaed;--text2:#9aa0b0;--text3:#6b7185;
    --red:#ff4757;--red-bg:rgba(255,71,87,.12);--red-border:rgba(255,71,87,.3);
    --orange:#ff9f43;--orange-bg:rgba(255,159,67,.12);--orange-border:rgba(255,159,67,.3);
    --yellow:#feca57;--yellow-bg:rgba(254,202,87,.12);--yellow-border:rgba(254,202,87,.3);
    --green:#2ed573;--green-bg:rgba(46,213,115,.12);--green-border:rgba(46,213,115,.3);
    --blue:#4facfe;--blue-bg:rgba(79,172,254,.12);
    --radius:12px;--radius-sm:8px;
    --glow-blue:0 0 0 3px rgba(79,172,254,.15);
  }
  html{font-size:16px;-webkit-text-size-adjust:100%}
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    background:var(--bg);color:var(--text);min-height:100dvh;
    padding:env(safe-area-inset-top) 0 calc(100px + env(safe-area-inset-bottom)) 0;
    overflow-x:hidden;
    background-image:radial-gradient(ellipse at 50% 0%,rgba(79,172,254,.04) 0%,transparent 60%),radial-gradient(ellipse at 80% 100%,rgba(46,213,115,.03) 0%,transparent 50%);
    background-attachment:fixed;
    letter-spacing:.01em;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  }
  .container{max-width:600px;margin:0 auto;padding:16px;padding-left:calc(16px + env(safe-area-inset-left));padding-right:calc(16px + env(safe-area-inset-right))}

  /* Header ‚Äî glassmorphism */
  header{text-align:center;padding:28px 20px 12px;margin:-16px -16px 0;margin-left:calc(-16px - env(safe-area-inset-left));margin-right:calc(-16px - env(safe-area-inset-right));background:linear-gradient(135deg,rgba(79,172,254,.08) 0%,rgba(46,213,115,.05) 50%,rgba(255,71,87,.05) 100%);border-bottom:1px solid rgba(255,255,255,.06);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}
  header h1{font-size:1.7rem;font-weight:800;margin-bottom:6px;letter-spacing:-.02em;line-height:1.2}
  header .subtitle{color:var(--text2);font-size:.85rem;font-weight:400;letter-spacing:.02em}

  /* Emergency banner ‚Äî prominent but not alarming */
  .emergency-banner{background:linear-gradient(135deg,rgba(255,71,87,.1) 0%,rgba(255,71,87,.06) 100%);border:1px solid var(--red-border);border-radius:var(--radius);padding:12px 16px;margin:16px 0;font-size:.8rem;color:#ff6b7a;text-align:center;line-height:1.5;position:relative;overflow:hidden}
  .emergency-banner::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--red)}
  .emergency-banner a{color:var(--red);font-weight:700;text-decoration:underline;text-underline-offset:2px}
  .emergency-banner a:hover{color:#ff6b7a}
  .emergency-banner a:active{opacity:.8}

  /* Tabs ‚Äî smooth transitions */
  .tabs{display:flex;gap:4px;margin:16px 0 14px;background:var(--surface);border-radius:var(--radius);padding:4px;border:1px solid rgba(255,255,255,.04)}
  .tab{flex:1;padding:12px 8px;min-height:44px;border:none;background:transparent;color:var(--text2);font-size:.82rem;font-weight:500;border-radius:var(--radius-sm);cursor:pointer;transition:all .25s ease;-webkit-tap-highlight-color:transparent;position:relative}
  .tab.active{background:var(--surface3);color:var(--text);font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,.2)}
  .tab:hover:not(.active){color:var(--text);background:rgba(255,255,255,.03)}
  .tab:active{transform:scale(.97);opacity:.9}
  .tab-content{display:none;animation:tabFadeIn .3s ease}
  .tab-content.active{display:block}
  @keyframes tabFadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

  /* Input area ‚Äî glow on focus */
  .input-group{position:relative;margin-bottom:16px}
  .input-group input,.input-group textarea{width:100%;background:var(--surface);border:2px solid var(--surface3);border-radius:var(--radius);padding:14px 16px;color:var(--text);font-size:1rem;font-family:inherit;outline:none;transition:border-color .25s ease,box-shadow .25s ease;line-height:1.5}
  .input-group textarea{min-height:120px;resize:vertical}
  .input-group input:focus,.input-group textarea:focus{border-color:var(--blue);box-shadow:var(--glow-blue)}
  .input-group input::placeholder,.input-group textarea::placeholder{color:var(--text3)}
  .clear-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:var(--surface3);border:none;color:var(--text2);width:36px;height:36px;border-radius:50%;cursor:pointer;font-size:1.2rem;display:none;align-items:center;justify-content:center;line-height:1;transition:all .2s ease;-webkit-tap-highlight-color:transparent}
  .clear-btn.show{display:flex}
  .clear-btn:hover{background:var(--surface2);color:var(--text)}
  .clear-btn:active{transform:translateY(-50%) scale(.9)}
  .input-group:has(textarea) .clear-btn{top:20px;transform:none}
  .input-group:has(textarea) .clear-btn:active{transform:scale(.9)}

  /* Results */
  .results{display:flex;flex-direction:column;gap:8px}
  .result-card{border-radius:var(--radius);padding:14px 16px;display:flex;gap:12px;align-items:flex-start;animation:slideIn .3s ease;transition:transform .2s ease}
  @keyframes slideIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
  .result-card.deadly{background:var(--red-bg);border:1px solid var(--red-border);animation:slideIn .3s ease,deadlyPulse 3s ease-in-out infinite}
  .result-card.dangerous{background:var(--orange-bg);border:1px solid var(--orange-border)}
  .result-card.caution{background:var(--yellow-bg);border:1px solid var(--yellow-border)}
  .result-card.safe{background:var(--green-bg);border:1px solid var(--green-border)}
  @keyframes deadlyPulse{0%,100%{border-color:var(--red-border);box-shadow:0 0 0 0 rgba(255,71,87,0)}50%{border-color:var(--red);box-shadow:0 0 12px 0 rgba(255,71,87,.15)}}
  .result-icon{font-size:1.5rem;flex-shrink:0;line-height:1.2}
  .result-body{flex:1;min-width:0}
  .result-title{font-weight:600;font-size:.95rem;margin-bottom:3px;line-height:1.4}
  .result-detail{font-size:.82rem;color:var(--text2);line-height:1.5}
  .deadly .result-title{color:var(--red)}
  .dangerous .result-title{color:var(--orange)}
  .caution .result-title{color:var(--yellow)}
  .safe .result-title{color:var(--green)}
  .result-badge{display:inline-block;padding:2px 8px;border-radius:20px;font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.4px;vertical-align:middle}
  .badge-deadly{background:var(--red);color:#fff}
  .badge-dangerous{background:var(--orange);color:#000}
  .badge-caution{background:var(--yellow);color:#000}
  .badge-safe{background:var(--green);color:#000}

  /* Dishes ‚Äî improved hover/transitions */
  .dishes-grid{display:flex;flex-direction:column;gap:8px}
  .dish-card{background:var(--surface);border:1px solid var(--surface3);border-radius:var(--radius);padding:14px 16px;min-height:44px;cursor:pointer;transition:all .25s ease;-webkit-tap-highlight-color:transparent}
  .dish-card:hover{border-color:var(--blue);background:var(--surface2);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
  .dish-card:active{transform:scale(.98);box-shadow:none}
  .dish-name{font-weight:600;font-size:.95rem;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;line-height:1.4}
  .dish-status{font-size:.75rem;padding:2px 8px;border-radius:20px;font-weight:600}
  .dish-detail{font-size:.8rem;color:var(--text2);line-height:1.5}
  .dish-section{margin-bottom:20px}
  .dish-section h3{font-size:.75rem;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;padding-left:4px;font-weight:600}

  /* Legend ‚Äî improved design */
  .legend{background:var(--surface);border:1px solid rgba(255,255,255,.04);border-radius:var(--radius);padding:18px;margin-top:20px}
  .legend h3{font-size:.82rem;font-weight:600;margin-bottom:12px;color:var(--text2);text-transform:uppercase;letter-spacing:.6px}
  .legend-item{display:flex;align-items:center;gap:12px;padding:8px 0;font-size:.82rem;line-height:1.4}
  .legend-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;box-shadow:0 0 6px currentColor}
  .legend-item:not(:last-child){border-bottom:1px solid rgba(255,255,255,.04)}

  /* Info section */
  .info-card{background:var(--surface);border:1px solid rgba(255,255,255,.04);border-radius:var(--radius);padding:18px;margin-top:12px;transition:border-color .2s ease}
  .info-card:hover{border-color:rgba(255,255,255,.08)}
  .info-card h3{font-size:.9rem;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:6px;letter-spacing:-.01em}
  .info-card ul{padding-left:18px;font-size:.82rem;color:var(--text2);line-height:1.9}
  .info-card li{padding:2px 0}
  .safe-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .safe-tag{background:var(--green-bg);border:1px solid var(--green-border);color:var(--green);padding:6px 14px;border-radius:20px;font-size:.78rem;font-weight:500;transition:all .2s ease}
  .safe-tag:hover{background:rgba(46,213,115,.18)}

  /* Search filter for dishes ‚Äî glow on focus */
  .dish-search{margin-bottom:14px}
  .dish-search input{width:100%;background:var(--surface);border:2px solid var(--surface3);border-radius:var(--radius);padding:12px 16px;min-height:44px;color:var(--text);font-size:.9rem;outline:none;transition:border-color .25s ease,box-shadow .25s ease}
  .dish-search input:focus{border-color:var(--blue);box-shadow:var(--glow-blue)}
  .dish-search input::placeholder{color:var(--text3)}

  .empty-state{text-align:center;padding:48px 20px;color:var(--text3)}
  .empty-state .icon{font-size:2.5rem;margin-bottom:12px}
  .empty-state p{font-size:.85rem;line-height:1.6}

  /* Footer */
  .footer{text-align:center;padding:32px 16px 16px;margin-top:24px;border-top:1px solid rgba(255,255,255,.04)}
  .footer p{font-size:.72rem;color:var(--text3);letter-spacing:.03em;line-height:1.5}

  /* Reduced motion preference */
  @media (prefers-reduced-motion:reduce){
    *,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>üõ°Ô∏è Food Safety Checker</h1>
    <p class="subtitle">Lebensmittel-Sicherheitspr√ºfung</p>
  </header>

  <div class="emergency-banner">
    üö® Im Notfall sofort <a href="tel:112">112 anrufen</a> ‚Äî Anaphylaxie-Risiko bei Eiern &amp; N√ºssen
  </div>

  <div class="tabs">
    <button class="tab active" data-tab="single" onclick="switchTab('single')">Einzelpr√ºfung</button>
    <button class="tab" data-tab="multi" onclick="switchTab('multi')">Zutatenliste</button>
    <button class="tab" data-tab="dishes" onclick="switchTab('dishes')">Gerichte</button>
    <button class="tab" data-tab="info" onclick="switchTab('info')">Info</button>
  </div>

  <!-- Single Check -->
  <div class="tab-content active" id="tab-single">
    <div class="input-group">
      <input type="text" id="singleInput" placeholder="Zutat oder Gericht eingeben‚Ä¶" autocomplete="off" autocapitalize="none" spellcheck="false">
      <button class="clear-btn" id="clearSingle" onclick="clearInput('single')">&times;</button>
    </div>
    <div class="results" id="singleResults"></div>
    <div class="empty-state" id="singleEmpty">
      <div class="icon">üîç</div>
      <p>Gib eine Zutat oder ein Gericht ein,<br>z.B. ‚ÄûEi", ‚ÄûCaesar Salad", ‚ÄûWalnuss"</p>
    </div>
  </div>

  <!-- Multi Check -->
  <div class="tab-content" id="tab-multi">
    <div class="input-group">
      <textarea id="multiInput" placeholder="Zutatenliste einf√ºgen (eine pro Zeile oder komma-getrennt)‚Ä¶&#10;&#10;z.B.:&#10;Mehl, Zucker, Butter, Eier, Vanille"></textarea>
      <button class="clear-btn" id="clearMulti" onclick="clearInput('multi')">&times;</button>
    </div>
    <div class="results" id="multiResults"></div>
    <div class="empty-state" id="multiEmpty">
      <div class="icon">üìã</div>
      <p>F√ºge eine vollst√§ndige Zutatenliste ein<br>und erhalte eine Analyse f√ºr jede Zutat</p>
    </div>
  </div>

  <!-- Common Dishes -->
  <div class="tab-content" id="tab-dishes">
    <div class="dish-search">
      <input type="text" id="dishSearch" placeholder="Gericht suchen‚Ä¶" oninput="filterDishes()">
    </div>
    <div class="dishes-grid" id="dishesGrid"></div>
  </div>

  <!-- Info -->
  <div class="tab-content" id="tab-info">
    <div class="info-card">
      <h3>üö® Lebensbedrohlich</h3>
      <ul>
        <li><strong>Eier (Eggs)</strong> ‚Äî in jeder Form: Mayonnaise, Meringue, Pasta mit Ei, Brioche, Baiser, Eierlik√∂r, R√ºhrei, Spiegelei‚Ä¶</li>
        <li><strong>N√ºsse (Nuts)</strong> ‚Äî ALLE au√üer Erdn√ºsse &amp; Mandeln: Walnuss, Haselnuss, Cashew, Pistazie, Pekanuss, Macadamia, Paranuss, Maronen‚Ä¶</li>
      </ul>
    </div>
    <div class="info-card">
      <h3>‚ö†Ô∏è Schwellung &amp; Atemnot</h3>
      <ul>
        <li>Gefl√ºgel (Huhn, Pute, Ente, Gans‚Ä¶)</li>
        <li>Avocado</li>
        <li>Kiwi</li>
        <li>Aubergine (Eggplant)</li>
        <li>Banane (Banana)</li>
        <li>Milch (Milk) ‚Äî alle Milchprodukte</li>
      </ul>
    </div>
    <div class="info-card">
      <h3>üòê Verdauungsprobleme (kleine Mengen OK)</h3>
      <ul>
        <li>Zu viel K√§se (Cheese)</li>
        <li>IBS/Reizdarm ‚Äî Low-FODMAP hilfreich</li>
        <li>Hohe FODMAP-Lebensmittel: Knoblauch, Zwiebeln, Bohnen, Weizen (gro√üe Mengen), √Ñpfel, Birnen‚Ä¶</li>
      </ul>
    </div>
    <div class="info-card">
      <h3>‚úÖ Sichere Ausnahmen</h3>
      <div class="safe-list">
        <span class="safe-tag">Erdn√ºsse / Peanuts ‚úÖ</span>
        <span class="safe-tag">Mandeln / Almonds ‚úÖ</span>
      </div>
    </div>
    <div class="legend">
      <h3>Farblegende</h3>
      <div class="legend-item"><span class="legend-dot" style="background:var(--red);color:var(--red)"></span> Lebensgefahr ‚Äî Niemals essen</div>
      <div class="legend-item"><span class="legend-dot" style="background:var(--orange);color:var(--orange)"></span> Gef√§hrlich ‚Äî Schwellung/Atemnot m√∂glich</div>
      <div class="legend-item"><span class="legend-dot" style="background:var(--yellow);color:var(--yellow)"></span> Vorsicht ‚Äî Verdauungsprobleme m√∂glich</div>
      <div class="legend-item"><span class="legend-dot" style="background:var(--green);color:var(--green)"></span> Sicher ‚Äî Kann bedenkenlos gegessen werden</div>
    </div>
  </div>

  <footer class="footer">
    <p>Food Safety Checker v2.0</p>
  </footer>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ Allergy Database ‚îÄ‚îÄ‚îÄ
const DEADLY = [
  {
    names: ['ei','eier','egg','eggs','eigelb','eiwei√ü','eiweiss','yolk','egg white','egg yolk','h√ºhnerei','huehnerei','vollei','trockenei','fl√ºssigei','eipulver','egg powder',
            'eiersalat','eierpfannkuchen','eiernockerl','eiersp√§tzle','eierspaetzle','eierkuchen','eierschwammerl','eierteigwaren','eiernudel','eiernudeln',
            'omelette','omelet','omelett','frittata','meringue','baiser','eierlik√∂r','eierlikor',
            'spiegelei','r√ºhrei','ruehrei','setzei','verlorenes ei','pochiertes ei',
            'scotch egg','egg wash','egg nog','eggnog','eierstich',
            'ei-pasta','eierpunsch','eierspeise','eiert√§tsch','eiertatsch'],
    label: 'Eier / Eggs',
    detail: 'Lebensbedrohliche Allergie ‚Äî in jeder Form vermeiden!'
  },
  {
    names: ['walnuss','waln√ºsse','walnut','walnuts','haselnuss','haseln√ºsse','hazelnut','hazelnuts','cashew','cashews','cashewkern','pistazie','pistazien','pistachio','pistachios',
            'pekanuss','pecan','pecans','macadamia','paranuss','brazil nut','brazil nuts','nuss','n√ºsse','nuesse','nut','nuts','tree nut','tree nuts','nussmischung','mixed nuts',
            'maronen','kastanien','chestnut','chestnuts','kokosnuss','coconut','pinienkern','pinienkerne','pine nut','pine nuts','nougat','nutella','gianduja','praline','marzipan',
            'nussecke','nussecken','nusskuchen','nusszopf','nusstorte','nussschnecke','nussschnecken','nussstrudel','nusskipferl','nussbeugel',
            'nussbrot','nussmus','nussmilch','nusspaste','nusscreme','nussaufstrich','nusslik√∂r','nusslikor',
            'walnusskern','walnusskerne','haselnusskern','haselnusskerne','cashewmus',
            'pistazieneis','pistaziencreme','pistazienmus',
            'haselnusslik√∂r','haselnusscreme','haselnussmus',
            'pekanusseis','macadamianuss','macadamian√ºsse',
            'nussriegel','nussstange','nussknacker','nussf√ºllung','nussfuellung'],
    exclude: ['erdnuss','erdn√ºsse','erdnuesse','peanut','peanuts','mandel','mandeln','almond','almonds','muskatnuss','muskat','nutmeg','kokosnuss','coconut','kokos','kokosmilch','kokosflocken','kokos√∂l','coconut milk','coconut oil','coconut cream','coconut flakes'],
    label: 'N√ºsse / Nuts',
    detail: 'Lebensbedrohliche Allergie ‚Äî ALLE N√ºsse au√üer Erdn√ºsse & Mandeln!'
  }
];

const DANGEROUS = [
  {
    names: ['huhn','h√ºhnchen','h√§hnchen','haehnchen','chicken','hendl','poulet','h√ºhnerbr√ºhe','chicken broth','chicken stock','gefl√ºgel','gefluegel','poultry',
            'pute','truthahn','turkey','ente','duck','gans','goose','wachtel','quail','fasan','pheasant','h√ºhnerbrust','chicken breast','h√ºhnerkeule','chicken thigh','chicken wing','h√ºhnerfl√ºgel',
            'h√ºhnerleber','chicken liver','h√ºhnerschenkel','h√ºhnersuppe','chicken soup','chicken nugget','chicken tender',
            'putenbrust','putenschnitzel','putenkeule','putensteak','putengeschnetzeltes',
            'entenkeule','entenbrust','entenconfit','duck breast','duck confit',
            'g√§nsebraten','gaensebraten','g√§nsekeule','gaensekeule','g√§nseleber','goose liver',
            'backhendl','brath√§hnchen','brathahnchen','grillh√§hnchen','grillhuhn',
            'h√ºhnerfrikassee','chicken fricassee','h√§hnchenbrust','haehnchenbrust','h√§hnchenschenkel',
            'gefl√ºgelsalat','gefl√ºgelleber','gefl√ºgelbr√ºhe','gefl√ºgelfond',
            'chicken satay','chicken tikka','tandoori chicken','rotisserie chicken'],
    label: 'Gefl√ºgel / Poultry',
    detail: 'Kann Halsschwellung und Atemnot verursachen!'
  },
  {
    names: ['avocado','guacamole','avocados','avocadocreme','avocadoaufstrich','avocado toast','avocado√∂l','avocado oil','avocadodip'],
    label: 'Avocado',
    detail: 'Kann Halsschwellung und Atemnot verursachen!'
  },
  {
    names: ['kiwi','kiwis','kiwifruit','kiwisaft','kiwismoothie','kiwi juice','gold kiwi','green kiwi'],
    label: 'Kiwi',
    detail: 'Kann Halsschwellung und Atemnot verursachen!'
  },
  {
    names: ['aubergine','auberginen','eggplant','eggplants','melanzani','auberginenp√ºree','auberginenpuree','auberginencreme','auberginensalat',
            'auberginenkaviar','auberginenauflauf','imam bayildi'],
    label: 'Aubergine / Eggplant',
    detail: 'Kann Halsschwellung und Atemnot verursachen!'
  },
  {
    names: ['banane','bananen','banana','bananas','plantain','plantains','bananensaft','bananenmilch','bananensplit','bananeneis',
            'bananenchips','bananenbrot','bananenkuchen','bananenpfannkuchen','bananenshake','banana split','banana shake','banana smoothie',
            'kochbanane','kochbananen'],
    label: 'Banane / Banana',
    detail: 'Kann Halsschwellung und Atemnot verursachen!'
  },
  {
    names: ['milch','milk','vollmilch','whole milk','magermilch','skim milk','buttermilch','buttermilk','sahne','cream','rahm','schlagsahne','whipped cream',
            'schmand','sour cream','saure sahne','cr√®me fra√Æche','creme fraiche','joghurt','yoghurt','yogurt','quark','kefir','molke','whey','laktose','lactose',
            'milchpulver','milk powder','kondensmilch','condensed milk','evaporated milk','butter','ghee',
            'milchschokolade','milk chocolate','milchreis','rice pudding','milchshake',
            'buttercreme','butterkeks','butterbrot','buttergeb√§ck','buttergebaeck','butterschmalz',
            'sahnetorte','sahneso√üe','sahnesosse','sahneeis','sahnebonbon','sahnelik√∂r','sahnehaube',
            'joghurtsauce','joghurtdressing','joghurteis','fruchtjoghurt','naturjoghurt','trinkjoghurt',
            'milchkaramell','milchcreme','milchbr√∂tchen','milchbroetchen','milchsuppe','milchkaffee',
            'quarkb√§llchen','quarkbaellchen','quarkkuchen','quarkstrudel','quarktasche',
            'kakao','hot chocolate','hei√üe schokolade','heisse schokolade','trinkschokolade',
            'bechamel','b√©chamel','bechamelsauce','b√©chamelsauce','white sauce','wei√üe sauce','weisse sauce',
            'topfen','obers','schlagobers','kaffeesahne','spr√ºhsahne',
            'half and half','heavy cream','double cream','clotted cream','single cream',
            'dulce de leche','karamell','caramel sauce'],
    label: 'Milch / Milk',
    detail: 'Kann Halsschwellung und Atemnot verursachen!'
  }
];

const CAUTION = [
  {
    names: ['k√§se','kaese','cheese','hartk√§se','hard cheese','weichk√§se','soft cheese','schmelzk√§se','processed cheese',
            'ricotta','mascarpone','mozzarella','parmesan','gouda','emmentaler','cheddar','brie','camembert','feta','gruy√®re','gruyere',
            'cream cheese','frischk√§se','frischkaese','h√ºttenk√§se','cottage cheese','ziegenk√§se','goat cheese','schafsk√§se','sheep cheese',
            'raclette','fondue',
            'appenzeller','tilsiter','bergk√§se','bergkaese','butterk√§se','butterkaese','edamer','gorgonzola','roquefort','stilton',
            'pecorino','provolone','halloumi','burrata','scamorza','taleggio','fontina','m√ºnster','muenster','limburger',
            'handk√§se','handkaese','harzer','harzer k√§se','harzer kaese','mainzer k√§se','mainzer kaese',
            'obatzda','obazda','liptauer','k√§sesp√§tzle','kaesespaetzle','k√§seso√üe','kaesesosse',
            'k√§sekuchen','kaesekuchen','cheesecake','k√§sebr√∂tchen','kaesebrot','k√§sebrot',
            'k√§sefondue','k√§seplatte','kaeseplatte','k√§seaufschnitt','k√§secreme',
            'string cheese','american cheese','swiss cheese','blue cheese','blauschimmelk√§se','blauschimmelkaese',
            'queso','paneer','manchego'],
    label: 'K√§se / Cheese',
    detail: 'Kleine Mengen OK ‚Äî gr√∂√üere Mengen k√∂nnen Verdauungsprobleme verursachen'
  },
  {
    names: ['knoblauch','garlic','zwiebel','zwiebeln','onion','onions','schalotte','shallot','lauch','leek','fr√ºhlingszwiebel','spring onion','schnittlauch','chives',
            'knoblauchzehe','knoblauchpulver','garlic powder','knoblauchbutter','garlic butter','knoblauchbrot','garlic bread',
            'knoblauchso√üe','knoblauchsosse','garlic sauce','aioli','knoblauch√∂l','garlic oil',
            'zwiebelringe','onion rings','zwiebelsuppe','onion soup','r√∂stzwiebeln','roestzwiebeln','fried onions',
            'zwiebelkuchen','zwiebelschmalz','perlzwiebel','silberzwiebel',
            'lauchsuppe','porree','b√§rlauch','baerlauch','wild garlic',
            'fr√ºhlingszwiebeln','fruehlingszwiebel','green onion','green onions','scallion','scallions'],
    label: 'Zwiebeln/Knoblauch (High FODMAP)',
    detail: 'IBS/Reizdarm ‚Äî kann in gr√∂√üeren Mengen Probleme verursachen'
  },
  {
    names: ['bohne','bohnen','bean','beans','linse','linsen','lentil','lentils','kichererbse','kichererbsen','chickpea','chickpeas','erbse','erbsen','pea','peas',
            'kidney bohne','kidneybohne','kidney bean','schwarze bohne','black bean','wei√üe bohne','weisse bohne','white bean',
            'limabohne','lima bean','sojabohne','soybean','edamame','fava bohne','fava bean','ackerbohne',
            'rote linse','rote linsen','red lentil','gr√ºne linse','gr√ºne linsen','green lentil','beluga linse',
            'bohneneintopf','linsensuppe','lentil soup','erbsensuppe','pea soup','erbsenp√ºree','erbsenpuree',
            'baked beans','refried beans','chili con carne','dal','dhal','daal',
            'h√ºlsenfr√ºchte','huelsenfruechte','legume','legumes'],
    label: 'H√ºlsenfr√ºchte (High FODMAP)',
    detail: 'IBS/Reizdarm ‚Äî kann Bl√§hungen und Beschwerden verursachen'
  },
  {
    names: ['apfel','√§pfel','apple','apples','birne','birnen','pear','pears','mango','mangos','wassermelone','watermelon','kirsche','kirschen','cherry','cherries',
            'pfirsich','pfirsiche','peach','peaches','pflaume','pflaumen','plum','plums','nektarine','nectarine','aprikose','apricot',
            'apfelmus','applesauce','apfelsaft','apple juice','apfelkuchen','apple pie','apfelstrudel',
            'birnenkompott','birnensaft','birnenmus',
            'mangosaft','mangop√ºree','mangopuree','mango chutney','mangolassi',
            'kirschsaft','kirschkompott','kirschkuchen','sauerkirsche','s√º√ükirsche',
            'pfirsichsaft','pfirsichkompott','pflaumenkompott','pflaumenmus','zwetschge','zwetschgen','zwetschgenkuchen',
            'aprikosenkonfit√ºre','aprikosenkonfit','aprikosenmarmelade','marille','marillen','marillenkn√∂del','marillenknoedel',
            'trockenobst','dried fruit','trockenfr√ºchte','trockenfruechte','d√∂rrpflaume','doerrpflaume','prune','prunes'],
    label: 'Obst (High FODMAP)',
    detail: 'IBS/Reizdarm ‚Äî kann in gr√∂√üeren Mengen Beschwerden verursachen'
  },
  {
    names: ['weizen','wheat','roggen','rye','gerste','barley','dinkel','spelt','brot','bread','br√∂tchen','roll','semmel','toast','pizza','pasta','nudel','nudeln','noodles','couscous','bulgur',
            'weizenmehl','wheat flour','roggenmehl','rye flour','dinkelmehl','spelt flour','vollkornmehl','wholemeal flour',
            'wei√übrot','weissbrot','white bread','vollkornbrot','whole wheat bread','schwarzbrot','pumpernickel','ciabatta','focaccia','baguette',
            'semmelbr√∂sel','semmelbroesel','breadcrumbs','paniermehl','panko',
            'pizzateig','pizza dough','nudelteig','bl√§tterteig','blaetterteig','puff pastry','m√ºrbteig','muerbteig','hefeteig',
            'tortellini','ravioli','lasagne','lasagna','spaghetti','penne','fusilli','tagliatelle','fettuccine','gnocchi',
            'croissant','pretzel','breze','brezel','brezn','laugenbrezel','laugenbreze'],
    label: 'Getreide/Weizen (FODMAP)',
    detail: 'IBS ‚Äî gro√üe Mengen Weizen k√∂nnen Probleme machen. Kleine Mengen meist OK.'
  }
];

const SAFE_EXCEPTIONS = [
  {
    names: ['erdnuss','erdn√ºsse','erdnuesse','peanut','peanuts','erdnussbutter','peanut butter','erdnuss√∂l','peanut oil',
            'erdnussmus','erdnusscreme','erdnussflips','erdnusssauce','peanut sauce','erdnusskerne','erdnusskern',
            'ger√∂stete erdn√ºsse','geroestete erdnuesse','roasted peanuts','gesalzene erdn√ºsse','salted peanuts',
            'erdnussriegel','peanut bar','erdnussdip','peanut dip'],
    label: 'Erdn√ºsse / Peanuts ‚úÖ',
    detail: 'Sicher! Erdn√ºsse sind KEINE Baumn√ºsse ‚Äî kein Risiko.'
  },
  {
    names: ['mandel','mandeln','almond','almonds','mandelmehl','almond flour','mandelmilch','almond milk','mandelmus','almond butter','mandel√∂l','almond oil',
            'mandelkern','mandelkerne','mandelbl√§ttchen','mandelblaettchen','sliced almonds','gehobelte mandeln','gemahlene mandeln','ground almonds',
            'mandelkuchen','mandelgeb√§ck','mandelgebaeck','mandelkrokant','mandelsplitter','mandelh√∂rnchen','mandelhoernchen',
            'mandelpaste','mandelcreme','mandelmilch','mandelp√ºree','mandelpuree','mandeldrink',
            'amaretto','amaretti','marzipan','marzipankartoffel','persipan'],
    label: 'Mandeln / Almonds ‚úÖ',
    detail: 'Sicher! Mandeln sind eine best√§tigte Ausnahme.'
  }
];

// ‚îÄ‚îÄ‚îÄ Hidden Ingredients in Common Dishes ‚îÄ‚îÄ‚îÄ
const DISH_DATABASE = [
  // ‚ïê‚ïê‚ïê DEADLY ‚Äî Lebensgefahr ‚ïê‚ïê‚ïê

  // International classics
  {name:'Caesar Salad',de:'Caesar Salat',level:'deadly',reason:'Enth√§lt Ei (im Dressing) und oft Parmesan (Milch)',triggers:['Eier','Milch']},
  {name:'Carbonara',de:'Carbonara',level:'deadly',reason:'Enth√§lt Ei (Eigelb), K√§se (Parmesan/Pecorino) und oft Speck',triggers:['Eier','Milch']},
  {name:'Tiramisu',de:'Tiramisu',level:'deadly',reason:'Enth√§lt rohe Eier, Mascarpone (Milch)',triggers:['Eier','Milch']},
  {name:'Mayonnaise',de:'Mayonnaise / Mayo',level:'deadly',reason:'Hauptbestandteil: Eier!',triggers:['Eier']},
  {name:'Brioche',de:'Brioche',level:'deadly',reason:'Enth√§lt Eier und Butter (Milch)',triggers:['Eier','Milch']},
  {name:'Pancakes',de:'Pfannkuchen',level:'deadly',reason:'Enth√§lt Eier und Milch',triggers:['Eier','Milch']},
  {name:'Waffles',de:'Waffeln',level:'deadly',reason:'Enth√§lt Eier und Milch',triggers:['Eier','Milch']},
  {name:'French Toast',de:'Arme Ritter',level:'deadly',reason:'In Ei-Milch-Mischung getr√§nkt',triggers:['Eier','Milch']},
  {name:'Quiche',de:'Quiche',level:'deadly',reason:'Enth√§lt Eier und Sahne/Milch',triggers:['Eier','Milch']},
  {name:'Cr√™pes',de:'Cr√™pes',level:'deadly',reason:'Enth√§lt Eier und Milch',triggers:['Eier','Milch']},
  {name:'Meringue',de:'Baiser / Meringue',level:'deadly',reason:'Besteht aus Eiwei√ü!',triggers:['Eier']},
  {name:'Hollandaise',de:'Sauce Hollandaise',level:'deadly',reason:'Enth√§lt Eigelb und Butter',triggers:['Eier','Milch']},
  {name:'B√©arnaise',de:'Sauce B√©arnaise',level:'deadly',reason:'Enth√§lt Eigelb und Butter',triggers:['Eier','Milch']},
  {name:'Custard / Pudding',de:'Pudding / Vanilleso√üe',level:'deadly',reason:'Enth√§lt Eier und Milch',triggers:['Eier','Milch']},
  {name:'Egg Fried Rice',de:'Gebratener Reis mit Ei',level:'deadly',reason:'Enth√§lt Ei',triggers:['Eier']},
  {name:'Pasta (fresh)',de:'Frische Pasta',level:'deadly',reason:'Frische Pasta enth√§lt fast immer Eier!',triggers:['Eier']},
  {name:'Ramen (traditional)',de:'Ramen (traditionell)',level:'deadly',reason:'Nudeln oft mit Ei, dazu oft Ei als Topping',triggers:['Eier']},
  {name:'Cake / Kuchen',de:'Kuchen / Torte',level:'deadly',reason:'Enth√§lt fast immer Eier und Milch/Butter',triggers:['Eier','Milch']},
  {name:'Ice Cream',de:'Eiscreme / Speiseeis',level:'deadly',reason:'Kann Eier enthalten (Vanilleeis), enth√§lt Milch. Oft N√ºsse!',triggers:['Eier','Milch','N√ºsse']},
  {name:'Mousse au Chocolat',de:'Mousse au Chocolat',level:'deadly',reason:'Enth√§lt Eier und Sahne. Oft mit Haseln√ºssen!',triggers:['Eier','Milch','N√ºsse']},
  {name:'Pesto',de:'Pesto',level:'deadly',reason:'Klassisch mit Pinienkernen (N√ºsse!) und Parmesan (Milch)',triggers:['N√ºsse','Milch']},
  {name:'Baklava',de:'Baklava',level:'deadly',reason:'Enth√§lt N√ºsse (Waln√ºsse, Pistazien)!',triggers:['N√ºsse']},
  {name:'Brownie',de:'Brownie',level:'deadly',reason:'Enth√§lt Eier, Butter, oft Waln√ºsse',triggers:['Eier','Milch','N√ºsse']},
  {name:'Granola / M√ºsli',de:'Granola / M√ºsli',level:'deadly',reason:'Enth√§lt oft diverse N√ºsse! Einzelne Zutaten pr√ºfen.',triggers:['N√ºsse']},
  {name:'Eierlik√∂r',de:'Eierlik√∂r',level:'deadly',reason:'Enth√§lt Eier und oft Sahne!',triggers:['Eier','Milch']},
  {name:'Aioli',de:'Aioli',level:'deadly',reason:'Traditionell mit Ei (wie Mayonnaise)',triggers:['Eier']},
  {name:'Eggs Benedict',de:'Eggs Benedict',level:'deadly',reason:'Pochiertes Ei + Sauce Hollandaise (Ei + Butter)',triggers:['Eier','Milch']},
  {name:'Souffl√©',de:'Souffl√©',level:'deadly',reason:'Hauptbestandteil: Eier',triggers:['Eier']},
  {name:'Pad Thai',de:'Pad Thai',level:'deadly',reason:'Enth√§lt oft Ei! Erdn√ºsse sind OK. Ohne Ei bestellen!',triggers:['Eier','Erdn√ºsse (sicher)']},
  {name:'Chicken Caesar Wrap',de:'Chicken Caesar Wrap',level:'deadly',reason:'H√§hnchen + Caesar Dressing (Ei) + Parmesan (Milch)',triggers:['Gefl√ºgel','Eier','Milch']},
  {name:'Lasagne',de:'Lasagne',level:'deadly',reason:'Enth√§lt Eier (Nudelplatten), B√©chamel (Milch), K√§se.',triggers:['Eier','Milch']},
  {name:'Frittata',de:'Frittata',level:'deadly',reason:'Italienisches Omelette ‚Äî Hauptbestandteil: Eier!',triggers:['Eier']},
  {name:'Shakshuka',de:'Shakshuka',level:'deadly',reason:'Eier in Tomatensauce pochiert! Kann auch K√§se enthalten.',triggers:['Eier','Milch']},
  {name:'Scotch Egg',de:'Scotch Egg',level:'deadly',reason:'Ei umh√ºllt von Hackfleisch und paniert (mit Ei)!',triggers:['Eier']},
  {name:'Tortilla Espa√±ola',de:'Spanische Tortilla',level:'deadly',reason:'Kartoffel-Omelette ‚Äî enth√§lt Eier!',triggers:['Eier']},
  {name:'Croque Monsieur',de:'Croque Monsieur',level:'deadly',reason:'Toast mit K√§se (Milch) und B√©chamelsauce (Milch, evtl. Ei).',triggers:['Eier','Milch']},
  {name:'Croque Madame',de:'Croque Madame',level:'deadly',reason:'Croque Monsieur mit Spiegelei obendrauf!',triggers:['Eier','Milch']},
  {name:'Tamagoyaki',de:'Tamagoyaki',level:'deadly',reason:'Japanisches Ei-Omelett ‚Äî Hauptbestandteil: Eier!',triggers:['Eier']},
  {name:'Naan Bread',de:'Naan-Brot',level:'deadly',reason:'Enth√§lt Joghurt (Milch) und oft Ei! Auch Butter/Ghee.',triggers:['Eier','Milch']},
  {name:'Croissant',de:'Croissant',level:'deadly',reason:'Enth√§lt Butter (Milch) und oft Ei!',triggers:['Eier','Milch']},
  {name:'Cr√®me br√ªl√©e',de:'Cr√®me br√ªl√©e',level:'deadly',reason:'Enth√§lt Eigelb und Sahne!',triggers:['Eier','Milch']},
  {name:'Profiteroles',de:'Profiteroles / Windbeutel',level:'deadly',reason:'Brandteig enth√§lt Eier! F√ºllung: Sahne (Milch).',triggers:['Eier','Milch']},
  {name:'Eclairs',de:'Eclairs',level:'deadly',reason:'Brandteig enth√§lt Eier! F√ºllung: Pudding/Sahne (Milch).',triggers:['Eier','Milch']},
  {name:'Remoulade',de:'Remoulade',level:'deadly',reason:'Enth√§lt Ei (Mayo-Basis)!',triggers:['Eier']},
  {name:'Strammer Max',de:'Strammer Max',level:'deadly',reason:'Brot mit Spiegelei! Klassisches deutsches Gericht.',triggers:['Eier']},
  {name:'Mac and Cheese',de:'Makkaroni mit K√§se',level:'deadly',reason:'Enth√§lt K√§se, Milch, Butter! Manchmal Ei.',triggers:['Milch','Eier']},

  // German / Austrian / Swiss deadly dishes
  {name:'Kaiserschmarrn',de:'Kaiserschmarrn',level:'deadly',reason:'Enth√§lt Eier und Milch! Traditionelles √∂sterreichisches Gericht aus Eierteig.',triggers:['Eier','Milch']},
  {name:'Wiener Schnitzel',de:'Wiener Schnitzel',level:'deadly',reason:'Panade enth√§lt Ei! Traditionell Kalbfleisch in Ei-Mehl-Br√∂sel-Panade.',triggers:['Eier']},
  {name:'Schnitzel (paniert)',de:'Schnitzel (paniert)',level:'deadly',reason:'Panade enth√§lt Ei! Egal ob Schwein, Kalb oder Pute ‚Äî die Panade hat Ei.',triggers:['Eier']},
  {name:'Sachertorte',de:'Sachertorte',level:'deadly',reason:'Enth√§lt Eier, Butter (Milch). Originalrezept ohne N√ºsse, aber Varianten k√∂nnen N√ºsse enthalten.',triggers:['Eier','Milch']},
  {name:'Linzer Torte',de:'Linzer Torte',level:'deadly',reason:'Enth√§lt N√ºsse (Haseln√ºsse/Waln√ºsse)! Klassisch mit gemahlenen N√ºssen im Teig. Auch Eier und Butter.',triggers:['N√ºsse','Eier','Milch']},
  {name:'Nussschnecke',de:'Nussschnecke',level:'deadly',reason:'Enth√§lt N√ºsse (Haseln√ºsse/Waln√ºsse) in der F√ºllung! Auch Eier und Butter im Teig.',triggers:['N√ºsse','Eier','Milch']},
  {name:'Nusskuchen',de:'Nusskuchen',level:'deadly',reason:'Hauptbestandteil: N√ºsse! Enth√§lt auch Eier und Butter.',triggers:['N√ºsse','Eier','Milch']},
  {name:'Nussecke',de:'Nussecke',level:'deadly',reason:'Enth√§lt N√ºsse (Haseln√ºsse) und Eier!',triggers:['N√ºsse','Eier','Milch']},
  {name:'Nusszopf',de:'Nusszopf',level:'deadly',reason:'Hefeteig mit Nussf√ºllung! Enth√§lt auch Eier und Milch.',triggers:['N√ºsse','Eier','Milch']},
  {name:'Nusstorte (Engadiner)',de:'Engadiner Nusstorte',level:'deadly',reason:'Schweizer Spezialit√§t mit Waln√ºssen, Eier, Sahne!',triggers:['N√ºsse','Eier','Milch']},
  {name:'Nusskn√∂del',de:'Nusskn√∂del',level:'deadly',reason:'Nussf√ºllung! Enth√§lt auch Eier.',triggers:['N√ºsse','Eier']},
  {name:'Semmelkn√∂del',de:'Semmelkn√∂del',level:'deadly',reason:'Enth√§lt Eier und oft Milch! Traditionell mit Ei gebunden.',triggers:['Eier','Milch']},
  {name:'Germkn√∂del',de:'Germkn√∂del',level:'deadly',reason:'Hefeteig mit Eier und Butter. Serviert mit Vanillesauce (Milch).',triggers:['Eier','Milch']},
  {name:'Apfelstrudel',de:'Apfelstrudel',level:'deadly',reason:'Strudelteig kann Ei enthalten. Oft mit Butter bestrichen. Manche Rezepte haben N√ºsse.',triggers:['Eier','Milch']},
  {name:'Topfenstrudel',de:'Topfenstrudel',level:'deadly',reason:'Enth√§lt Topfen/Quark (Milch) und Eier!',triggers:['Eier','Milch']},
  {name:'Palatschinken',de:'Palatschinken',level:'deadly',reason:'√ñsterreichische Pfannkuchen ‚Äî Eier und Milch im Teig!',triggers:['Eier','Milch']},
  {name:'Salzburger Nockerl',de:'Salzburger Nockerl',level:'deadly',reason:'Besteht haupts√§chlich aus Eischnee (Eier) und Zucker! Auch Butter.',triggers:['Eier','Milch']},
  {name:'Buchteln',de:'Buchteln',level:'deadly',reason:'Hefeteig mit Eier, Milch und Butter!',triggers:['Eier','Milch']},
  {name:'Marillenkn√∂del',de:'Marillenkn√∂del',level:'deadly',reason:'Topfenteig (Quark/Milch) mit Ei! Gef√ºllt mit Marille.',triggers:['Eier','Milch']},
  {name:'Zwetschgenkn√∂del',de:'Zwetschgenkn√∂del',level:'deadly',reason:'Kartoffel- oder Topfenteig mit Ei! Gef√ºllt mit Zwetschgen.',triggers:['Eier','Milch']},
  {name:'Dampfnudeln',de:'Dampfnudeln',level:'deadly',reason:'Hefeteig mit Eier und Milch. Serviert mit Vanillesauce.',triggers:['Eier','Milch']},
  {name:'Bienenstich',de:'Bienenstich',level:'deadly',reason:'Enth√§lt Eier im Teig, Sahne/Pudding-F√ºllung (Milch), Mandeldecke (Mandeln sicher!).',triggers:['Eier','Milch']},
  {name:'Schwarzw√§lder Kirschtorte',de:'Schwarzw√§lder Kirschtorte',level:'deadly',reason:'Enth√§lt Eier, Sahne (Milch), Schokolade.',triggers:['Eier','Milch']},
  {name:'Donauwelle',de:'Donauwelle',level:'deadly',reason:'Enth√§lt Eier, Butter, Sahne, Schokolade. Manchmal N√ºsse.',triggers:['Eier','Milch']},
  {name:'Frankfurter Kranz',de:'Frankfurter Kranz',level:'deadly',reason:'Enth√§lt Eier, Buttercreme (Milch). Oft mit N√ºssen/Krokant dekoriert!',triggers:['Eier','Milch','N√ºsse']},
  {name:'Baumkuchen',de:'Baumkuchen',level:'deadly',reason:'Enth√§lt sehr viele Eier und Butter! Deutsche Spezialit√§t.',triggers:['Eier','Milch']},
  {name:'K√§sesahnetorte',de:'K√§sesahnetorte',level:'deadly',reason:'Enth√§lt Eier, Quark (Milch), Sahne (Milch)!',triggers:['Eier','Milch']},
  {name:'Eierpfannkuchen',de:'Eierpfannkuchen',level:'deadly',reason:'Pfannkuchen aus Eier und Milch!',triggers:['Eier','Milch']},
  {name:'Eiersalat',de:'Eiersalat',level:'deadly',reason:'Hauptbestandteil: gekochte Eier mit Mayo (auch Ei)!',triggers:['Eier']},
  {name:'Sp√§tzle',de:'Sp√§tzle',level:'deadly',reason:'Schw√§bische Eiernudeln ‚Äî Hauptbestandteil ist Ei!',triggers:['Eier']},
  {name:'K√§sesp√§tzle',de:'K√§sesp√§tzle',level:'deadly',reason:'Sp√§tzle (Ei!) mit K√§se (Milch) √ºberbacken!',triggers:['Eier','Milch']},
  {name:'Maultaschen',de:'Maultaschen',level:'deadly',reason:'Schw√§bische Teigtaschen ‚Äî Nudelteig enth√§lt Ei! F√ºllung kann auch Ei enthalten.',triggers:['Eier']},
  {name:'Cordon Bleu',de:'Cordon Bleu',level:'deadly',reason:'Paniertes Schnitzel mit K√§se und Schinken ‚Äî Ei in Panade + K√§se (Milch)!',triggers:['Eier','Milch']},
  {name:'Fleischpflanzerl',de:'Fleischpflanzerl / Frikadellen',level:'deadly',reason:'Hackfleischb√§llchen enthalten Ei als Bindemittel! Auch oft Semmel mit Milch.',triggers:['Eier','Milch']},
  {name:'Frikadellen',de:'Frikadellen / Buletten',level:'deadly',reason:'Hackfleischb√§llchen enthalten Ei als Bindemittel!',triggers:['Eier']},
  {name:'K√∂nigsberger Klopse',de:'K√∂nigsberger Klopse',level:'deadly',reason:'Fleischkl√∂√üe mit Ei, Kapernso√üe enth√§lt oft Sahne und Eigelb!',triggers:['Eier','Milch']},
  {name:'Labskaus',de:'Labskaus',level:'deadly',reason:'Norddeutsches Gericht ‚Äî enth√§lt oft Spiegelei obendrauf!',triggers:['Eier']},
  {name:'Kartoffelsalat (norddeutsch)',de:'Kartoffelsalat (norddeutsch)',level:'deadly',reason:'Norddeutscher Kartoffelsalat mit Mayonnaise ‚Äî enth√§lt Ei!',triggers:['Eier']},
  {name:'Lebkuchen',de:'Lebkuchen',level:'deadly',reason:'Enth√§lt oft N√ºsse (Haseln√ºsse) und Eier! Zuckerguss kann Eiwei√ü enthalten.',triggers:['N√ºsse','Eier']},
  {name:'Stollen',de:'Stollen / Christstollen',level:'deadly',reason:'Enth√§lt Eier, Butter (Milch). Oft auch N√ºsse.',triggers:['Eier','Milch']},
  {name:'Zimtsterne',de:'Zimtsterne',level:'deadly',reason:'Enth√§lt gemahlene N√ºsse (Haseln√ºsse/Mandeln) und Eiwei√ü!',triggers:['N√ºsse','Eier']},
  {name:'Vanillekipferl',de:'Vanillekipferl',level:'deadly',reason:'Enth√§lt gemahlene N√ºsse (Haseln√ºsse/Waln√ºsse), Butter, oft Eigelb.',triggers:['N√ºsse','Eier','Milch']},
  {name:'Spritzgeb√§ck',de:'Spritzgeb√§ck',level:'deadly',reason:'Enth√§lt Eier und Butter.',triggers:['Eier','Milch']},
  {name:'Spaghettieis',de:'Spaghettieis',level:'deadly',reason:'Vanilleeis (Milch, evtl. Ei) mit Erdbeerso√üe und wei√üer Schokolade.',triggers:['Eier','Milch']},
  {name:'Bircher M√ºesli',de:'Bircher M√ºesli',level:'deadly',reason:'Schweizer M√ºsli mit N√ºssen (Haseln√ºsse) und oft Joghurt/Milch!',triggers:['N√ºsse','Milch']},
  {name:'√Ñlplermagronen',de:'√Ñlplermagronen',level:'deadly',reason:'Schweizer Makkaroni mit K√§se (Milch), Sahne, oft Ei!',triggers:['Eier','Milch']},
  {name:'R√∂sti mit Ei',de:'R√∂sti mit Spiegelei',level:'deadly',reason:'R√∂sti selbst sicher, aber mit Spiegelei serviert ‚Äî Ei!',triggers:['Eier']},

  // ‚ïê‚ïê‚ïê DANGEROUS ‚Äî Gef√§hrlich ‚ïê‚ïê‚ïê

  // International dangerous
  {name:'Chicken Nuggets',de:'Chicken Nuggets',level:'dangerous',reason:'Gefl√ºgel! Panade kann auch Ei enthalten.',triggers:['Gefl√ºgel','Eier']},
  {name:'Chicken Curry',de:'H√§hnchen Curry',level:'dangerous',reason:'Gefl√ºgel! Kann auch Joghurt/Sahne enthalten.',triggers:['Gefl√ºgel','Milch']},
  {name:'Club Sandwich',de:'Club Sandwich',level:'dangerous',reason:'Enth√§lt H√§hnchen und oft Mayonnaise (Ei)',triggers:['Gefl√ºgel','Eier']},
  {name:'Duck / Ente',de:'Ente / Entenbraten',level:'dangerous',reason:'Gefl√ºgel!',triggers:['Gefl√ºgel']},
  {name:'Turkey Sandwich',de:'Puten-Sandwich',level:'dangerous',reason:'Gefl√ºgel!',triggers:['Gefl√ºgel']},
  {name:'Guacamole',de:'Guacamole',level:'dangerous',reason:'Hauptbestandteil: Avocado!',triggers:['Avocado']},
  {name:'Sushi (some)',de:'Sushi (manche)',level:'dangerous',reason:'Avocado-Rollen! Auch: Tamago = Ei-Omelette',triggers:['Avocado','Eier']},
  {name:'Smoothie Bowl',de:'Smoothie Bowl',level:'dangerous',reason:'Oft mit Banane, Kiwi, Avocado, N√ºssen ‚Äî alles pr√ºfen!',triggers:['Banane','Kiwi','N√ºsse']},
  {name:'Banana Bread',de:'Bananenbrot',level:'dangerous',reason:'Banane + Eier + oft Waln√ºsse!',triggers:['Banane','Eier','N√ºsse']},
  {name:'Fruit Salad',de:'Obstsalat',level:'dangerous',reason:'Kann Kiwi und Banane enthalten ‚Äî nachfragen!',triggers:['Kiwi','Banane']},
  {name:'Moussaka',de:'Moussaka',level:'dangerous',reason:'Enth√§lt Aubergine, B√©chamel (Milch, evtl. Ei)',triggers:['Aubergine','Milch','Eier']},
  {name:'Baba Ghanoush',de:'Baba Ghanoush',level:'dangerous',reason:'Hauptbestandteil: Aubergine!',triggers:['Aubergine']},
  {name:'Milkshake',de:'Milchshake',level:'dangerous',reason:'Milch! Oft auch Eis (kann Ei enthalten)',triggers:['Milch','Eier']},
  {name:'Cappuccino / Latte',de:'Cappuccino / Latte',level:'dangerous',reason:'Enth√§lt Milch!',triggers:['Milch']},
  {name:'Butter Chicken',de:'Butter Chicken',level:'dangerous',reason:'Gefl√ºgel! Enth√§lt Butter und Sahne (Milch).',triggers:['Gefl√ºgel','Milch']},
  {name:'Chicken Tikka Masala',de:'Chicken Tikka Masala',level:'dangerous',reason:'Gefl√ºgel! Enth√§lt Joghurt und Sahne (Milch).',triggers:['Gefl√ºgel','Milch']},
  {name:'Tandoori Chicken',de:'Tandoori Chicken',level:'dangerous',reason:'Gefl√ºgel! Mariniert in Joghurt (Milch).',triggers:['Gefl√ºgel','Milch']},
  {name:'Tom Kha Gai',de:'Tom Kha Gai',level:'dangerous',reason:'Thail√§ndische H√ºhnersuppe ‚Äî Gefl√ºgel!',triggers:['Gefl√ºgel']},
  {name:'Peking-Ente',de:'Peking-Ente',level:'dangerous',reason:'Ente = Gefl√ºgel!',triggers:['Gefl√ºgel']},
  {name:'H√ºhnersuppe',de:'H√ºhnersuppe',level:'dangerous',reason:'Gefl√ºgel! Oft auch mit Eiernudeln.',triggers:['Gefl√ºgel','Eier']},
  {name:'Pho Ga',de:'Pho Ga (H√ºhner-Pho)',level:'dangerous',reason:'Vietnamesische H√ºhnersuppe ‚Äî Gefl√ºgel!',triggers:['Gefl√ºgel']},
  {name:'Satay (H√§hnchen)',de:'Satay / Sat√© (H√§hnchen)',level:'dangerous',reason:'H√ºhnchen = Gefl√ºgel! Erdnusssauce ist sicher.',triggers:['Gefl√ºgel']},
  {name:'Pizza Margherita',de:'Pizza Margherita',level:'dangerous',reason:'Enth√§lt Mozzarella (Milch)! Teig meist ohne Ei.',triggers:['Milch']},
  {name:'Pizza (allgemein)',de:'Pizza',level:'dangerous',reason:'Fast immer mit K√§se (Milch)! Teig pr√ºfen auf Ei.',triggers:['Milch']},
  {name:'Risotto',de:'Risotto',level:'dangerous',reason:'Enth√§lt oft Butter und Parmesan (Milch)!',triggers:['Milch']},
  {name:'Gratin / Auflauf',de:'Gratin / Auflauf',level:'dangerous',reason:'√úberbacken mit K√§se (Milch)! Oft auch Sahne und Ei.',triggers:['Milch','Eier']},
  {name:'Kartoffelgratin',de:'Kartoffelgratin',level:'dangerous',reason:'Kartoffeln mit Sahne und K√§se √ºberbacken (Milch)!',triggers:['Milch']},
  {name:'Nachos',de:'Nachos',level:'dangerous',reason:'Oft mit K√§se √ºberbacken (Milch)! Sour Cream (Milch). Guacamole (Avocado)!',triggers:['Milch','Avocado']},
  {name:'Panna Cotta',de:'Panna Cotta',level:'dangerous',reason:'Enth√§lt Sahne (Milch)! Traditionell ohne Ei.',triggers:['Milch']},
  {name:'Fondue (Schokolade)',de:'Schokofondue',level:'dangerous',reason:'Schokolade + Sahne (Milch)! Oft mit Banane zum Dippen.',triggers:['Milch']},
  {name:'Chicken Shawarma',de:'Chicken Shawarma',level:'dangerous',reason:'Gefl√ºgel! Oft mit Joghurtsauce (Milch).',triggers:['Gefl√ºgel','Milch']},

  // German / Austrian / Swiss dangerous
  {name:'D√∂ner Kebab',de:'D√∂ner Kebab',level:'dangerous',reason:'Vorsicht bei Joghurtsauce (Milch)! Fleisch (Kalb/Lamm) sicher, aber Sauce pr√ºfen. H√§hnchen-D√∂ner = Gefl√ºgel!',triggers:['Milch','Gefl√ºgel']},
  {name:'D√ºr√ºm',de:'D√ºr√ºm',level:'dangerous',reason:'Wie D√∂ner ‚Äî Sauce pr√ºfen! Joghurtsauce (Milch). H√§hnchen = Gefl√ºgel.',triggers:['Milch','Gefl√ºgel']},
  {name:'Pide',de:'Pide',level:'dangerous',reason:'T√ºrkische Teigschiffchen ‚Äî oft mit K√§se (Milch) oder Ei gef√ºllt! Variante pr√ºfen.',triggers:['Milch','Eier']},
  {name:'Flammkuchen',de:'Flammkuchen',level:'dangerous',reason:'Schmand/Cr√®me fra√Æche (Milch). Ohne Ei, aber Milchprodukt!',triggers:['Milch']},
  {name:'Obatzda',de:'Obatzda',level:'dangerous',reason:'Bayerischer K√§seaufstrich ‚Äî Camembert + Butter (Milch)!',triggers:['Milch']},
  {name:'Butterbreze',de:'Butterbreze',level:'dangerous',reason:'Breze mit Butter (Milch)!',triggers:['Milch']},
  {name:'Tzatziki',de:'Tzatziki',level:'dangerous',reason:'Joghurt-basiert (Milch)!',triggers:['Milch']},
  {name:'Fondue (K√§se)',de:'K√§sefondue',level:'dangerous',reason:'Geschmolzener K√§se (Milch)! Gruy√®re, Emmentaler etc.',triggers:['Milch']},
  {name:'Raclette',de:'Raclette',level:'dangerous',reason:'Geschmolzener Raclettek√§se (Milch)!',triggers:['Milch']},
  {name:'Z√ºrcher Geschnetzeltes',de:'Z√ºrcher Geschnetzeltes',level:'dangerous',reason:'Kalbsgeschnetzeltes mit Sahnesauce (Milch)!',triggers:['Milch']},

  // ‚ïê‚ïê‚ïê SAFE ‚Äî Sicher ‚ïê‚ïê‚ïê

  {name:'Marzipan',de:'Marzipan',level:'safe',reason:'Besteht aus Mandeln ‚Äî Mandeln sind sicher! Aber Vorsicht: kann in Mischprodukten mit anderen N√ºssen vorkommen.',triggers:['Mandeln (sicher)']},
  {name:'Steak',de:'Steak (Rind)',level:'safe',reason:'Rindfleisch ist sicher. Auf Beilagen achten!',triggers:[]},
  {name:'Grilled Fish',de:'Gegrillter Fisch',level:'safe',reason:'Fisch ist grunds√§tzlich sicher. Auf Sauce/Panade achten!',triggers:[]},
  {name:'Rice / Reis',de:'Reis',level:'safe',reason:'Reis pur ist sicher.',triggers:[]},
  {name:'Pommes Frites',de:'Pommes Frites',level:'safe',reason:'Kartoffeln + √ñl = sicher. Vorsicht bei Mayo als Dip!',triggers:[]},
  {name:'Hummus',de:'Hummus',level:'safe',reason:'Kichererbsen + Tahini (Sesam) ‚Äî grunds√§tzlich sicher. Gro√üe Mengen: FODMAP beachten.',triggers:[]},
  {name:'Spaghetti Aglio e Olio',de:'Spaghetti Aglio e Olio',level:'safe',reason:'Trockene Pasta (ohne Ei) + Knoblauch + Oliven√∂l. Sicher wenn Pasta eifrei! Knoblauch: FODMAP beachten.',triggers:[]},
  {name:'Bruschetta',de:'Bruschetta',level:'safe',reason:'Brot + Tomaten + Oliven√∂l. Sicher!',triggers:[]},
  {name:'Edamame',de:'Edamame',level:'safe',reason:'Sojabohnen ‚Äî sicher.',triggers:[]},
  {name:'Sashimi',de:'Sashimi',level:'safe',reason:'Roher Fisch pur ‚Äî sicher.',triggers:[]},
  {name:'R√∂sti',de:'R√∂sti',level:'safe',reason:'Geriebene Kartoffeln, gebraten. Grunds√§tzlich sicher! Auf Beilagen achten.',triggers:[]},
  {name:'Leberk√§se',de:'Leberk√§se / Fleischk√§se',level:'safe',reason:'Trotz des Namens: KEIN K√§se und KEINE Eier! Besteht aus Rind/Schwein. Sicher!',triggers:[]},
  {name:'Bratwurst',de:'Bratwurst',level:'safe',reason:'Schweinefleisch ‚Äî grunds√§tzlich sicher! Auf Beilagen/Saucen achten.',triggers:[]},
  {name:'Currywurst',de:'Currywurst',level:'safe',reason:'Schweinewurst mit Curryso√üe ‚Äî meist sicher! Manche So√üen k√∂nnen Joghurt enthalten.',triggers:[]},
  {name:'Brezen',de:'Brezen / Bretzel',level:'safe',reason:'Laugengeb√§ck ‚Äî grunds√§tzlich sicher! Vorsicht bei Butter-Breze (Milch).',triggers:[]},
  {name:'Wei√üwurst',de:'Wei√üwurst',level:'safe',reason:'Kalbfleisch + Schweinefleisch. Grunds√§tzlich sicher! S√º√üer Senf ist OK.',triggers:[]},
  {name:'Bockwurst',de:'Bockwurst',level:'safe',reason:'Schweine-/Rindfleisch ‚Äî grunds√§tzlich sicher!',triggers:[]},
  {name:'Wiener W√ºrstchen',de:'Wiener W√ºrstchen / Frankfurter',level:'safe',reason:'Schweine-/Rindfleisch ‚Äî grunds√§tzlich sicher!',triggers:[]},
  {name:'Sauerkraut',de:'Sauerkraut',level:'safe',reason:'Fermentierter Kohl ‚Äî sicher!',triggers:[]},
  {name:'Kartoffelkn√∂del',de:'Kartoffelkn√∂del',level:'safe',reason:'Kartoffelkn√∂del ohne Ei sind sicher! Nachfragen ob Ei im Teig.',triggers:[]},
  {name:'Schweinshaxe',de:'Schweinshaxe',level:'safe',reason:'Schweinefleisch ‚Äî sicher! Auf Beilagen achten.',triggers:[]},
  {name:'Sauerbraten',de:'Sauerbraten',level:'safe',reason:'Eingelegtes Rindfleisch ‚Äî grunds√§tzlich sicher! So√üe pr√ºfen (kann Sahne enthalten).',triggers:[]},
  {name:'Rouladen',de:'Rouladen / Rinderrouladen',level:'safe',reason:'Rindfleisch mit Gurke, Senf, Speck ‚Äî grunds√§tzlich sicher!',triggers:[]},
  {name:'Gulasch',de:'Gulasch',level:'safe',reason:'Rind-/Schweinefleisch mit Paprika ‚Äî grunds√§tzlich sicher! Manche Rezepte mit Sahne.',triggers:[]},
  {name:'Eintopf',de:'Eintopf',level:'safe',reason:'Je nach Rezept ‚Äî Grundzutaten (Kartoffeln, Gem√ºse, Fleisch) sicher. Zutaten pr√ºfen!',triggers:[]},
  {name:'Gr√ºnkohl',de:'Gr√ºnkohl mit Pinkel',level:'safe',reason:'Gr√ºnkohl mit Wurst ‚Äî grunds√§tzlich sicher!',triggers:[]},
  {name:'Matjes',de:'Matjes',level:'safe',reason:'Eingelegter Hering ‚Äî sicher! Auf Sahnesauce achten (Milch).',triggers:[]},
  {name:'Fischbr√∂tchen',de:'Fischbr√∂tchen',level:'safe',reason:'Fisch im Br√∂tchen ‚Äî grunds√§tzlich sicher! Vorsicht bei Remoulade (enth√§lt Ei!).',triggers:[]},
  {name:'Senf',de:'Senf / Mustard',level:'safe',reason:'Senf ist sicher!',triggers:[]},
  {name:'Ketchup',de:'Ketchup',level:'safe',reason:'Ketchup ist sicher!',triggers:[]},
  {name:'Kartoffelsalat (s√ºddeutsch)',de:'Kartoffelsalat (s√ºddeutsch)',level:'safe',reason:'S√ºddeutscher Kartoffelsalat mit Br√ºhe und Essig ‚Äî meist sicher!',triggers:[]},
  {name:'Tafelspitz',de:'Tafelspitz',level:'safe',reason:'Gekochtes Rindfleisch ‚Äî sicher! Meerrettichso√üe meist ohne Ei.',triggers:[]},
  {name:'Schweinebraten',de:'Schweinebraten',level:'safe',reason:'Schweinefleisch ‚Äî sicher! Auf Kn√∂del/So√üe achten.',triggers:[]},
  {name:'Falafel',de:'Falafel',level:'safe',reason:'Kichererbsen ‚Äî grunds√§tzlich sicher! FODMAP beachten. Auf Saucen achten.',triggers:[]},
  {name:'Gyros',de:'Gyros',level:'safe',reason:'Schweinefleisch ‚Äî sicher! Vorsicht bei Tzatziki (Milch/Joghurt).',triggers:[]},
  {name:'Lahmacun',de:'Lahmacun',level:'safe',reason:'T√ºrkische Pizza mit Hackfleisch ‚Äî grunds√§tzlich sicher!',triggers:[]},
  {name:'Hot Dog',de:'Hot Dog',level:'safe',reason:'Wurst im Br√∂tchen ‚Äî grunds√§tzlich sicher! Auf Saucen achten (Remoulade = Ei!).',triggers:[]},
  {name:'Tacos (Fleisch)',de:'Tacos (Fleisch)',level:'safe',reason:'Rindfleisch/Schwein in Maistortilla ‚Äî grunds√§tzlich sicher! Auf Saucen achten.',triggers:[]},
  {name:'Pho Bo',de:'Pho Bo (Rinder-Pho)',level:'safe',reason:'Vietnamesische Rindersuppe ‚Äî grunds√§tzlich sicher!',triggers:[]},
  {name:'Sommerrollen',de:'Sommerrollen / Spring Rolls',level:'safe',reason:'Reispapier + Gem√ºse + Garnelen ‚Äî sicher! Erdnusssauce ist OK.',triggers:[]},
  {name:'Tom Yum',de:'Tom Yum Suppe',level:'safe',reason:'Thail√§ndische Suppe ‚Äî grunds√§tzlich sicher!',triggers:[]},
  {name:'Gazpacho',de:'Gazpacho',level:'safe',reason:'Kalte Gem√ºsesuppe ‚Äî sicher!',triggers:[]},
  {name:'Pulled Pork',de:'Pulled Pork',level:'safe',reason:'Schweinefleisch ‚Äî sicher! Auf Beilagen achten.',triggers:[]},
  {name:'Spare Ribs',de:'Spare Ribs',level:'safe',reason:'Schweinerippchen ‚Äî sicher!',triggers:[]},
  {name:'Tortilla Chips',de:'Tortilla Chips',level:'safe',reason:'Mais + √ñl ‚Äî sicher! Auf Dips achten.',triggers:[]},
  {name:'Bibimbap (ohne Ei)',de:'Bibimbap (ohne Ei)',level:'safe',reason:'Koreanisches Reisgericht ‚Äî ohne Ei bestellen! Grundzutaten sicher.',triggers:[]},
];

// ‚îÄ‚îÄ‚îÄ Smart Matching for German Compound Words ‚îÄ‚îÄ‚îÄ
function escapeRegex(str) {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function smartMatch(query, name) {
  if (query === name) return true;
  if (query.length < 2 || name.length < 2) return false;

  // Word boundary match for multi-word inputs
  // e.g., "scrambled eggs" contains "eggs", "3. eier" contains "eier"
  const esc = escapeRegex(name);
  const wbRe = new RegExp('(?:^|[\\s,;/&+.:!?()\\[\\]])' + esc + '(?:$|[\\s,;/&+.:!?()\\[\\]])', 'i');
  if (wbRe.test(query)) return true;

  // German compound word matching:
  // "spiegelei" ends with "ei" ‚Üí match (Spiegel+Ei)
  // "eierkuchen" starts with "eier" ‚Üí match (Eier+Kuchen)
  // "rindfleisch" does NOT start/end with "ei" ‚Üí no match
  if (query.startsWith(name) || query.endsWith(name)) return true;

  // Reverse: partial typing matches allergen name prefix
  // "wal" ‚Üí "walnuss" starts with "wal" ‚Üí match
  // NOTE: name.endsWith(query) removed ‚Äî causes cross-category false positives
  // e.g., "milch" matching "nussmilch" in nuts, "butter" matching "erdnussbutter"
  if (name.startsWith(query)) return true;

  return false;
}

// ‚îÄ‚îÄ‚îÄ Core Check Function ‚îÄ‚îÄ‚îÄ
function checkIngredient(input) {
  const q = input.toLowerCase().trim();
  if (!q) return null;

  // Check safe exceptions FIRST
  for (const item of SAFE_EXCEPTIONS) {
    if (item.names.some(n => smartMatch(q, n))) {
      return { level: 'safe', icon: '‚úÖ', label: item.label, detail: item.detail, badge: 'Sicher', badgeClass: 'badge-safe' };
    }
  }

  // Check deadly
  for (const item of DEADLY) {
    const excluded = item.exclude ? item.exclude.some(ex => smartMatch(q, ex)) : false;
    if (!excluded && item.names.some(n => smartMatch(q, n))) {
      return { level: 'deadly', icon: 'üö®', label: item.label, detail: item.detail, badge: 'Lebensgefahr', badgeClass: 'badge-deadly' };
    }
  }

  // Check dangerous
  for (const item of DANGEROUS) {
    if (item.names.some(n => smartMatch(q, n))) {
      return { level: 'dangerous', icon: '‚ö†Ô∏è', label: item.label, detail: item.detail, badge: 'Gef√§hrlich', badgeClass: 'badge-dangerous' };
    }
  }

  // Check caution
  for (const item of CAUTION) {
    if (item.names.some(n => smartMatch(q, n))) {
      return { level: 'caution', icon: 'üòê', label: item.label, detail: item.detail, badge: 'Vorsicht', badgeClass: 'badge-caution' };
    }
  }

  // Check dish database
  const dish = DISH_DATABASE.find(d =>
    d.name.toLowerCase() === q || d.de.toLowerCase() === q ||
    q.includes(d.name.toLowerCase()) || q.includes(d.de.toLowerCase()) ||
    d.name.toLowerCase().includes(q) || d.de.toLowerCase().includes(q)
  );
  if (dish) {
    const levelMap = {
      deadly:    { icon:'üö®', badge:'Lebensgefahr', badgeClass:'badge-deadly' },
      dangerous: { icon:'‚ö†Ô∏è', badge:'Gef√§hrlich', badgeClass:'badge-dangerous' },
      caution:   { icon:'üòê', badge:'Vorsicht', badgeClass:'badge-caution' },
      safe:      { icon:'‚úÖ', badge:'Sicher', badgeClass:'badge-safe' }
    };
    const m = levelMap[dish.level];
    return { level: dish.level, icon: m.icon, label: dish.name + ' / ' + dish.de, detail: dish.reason + (dish.triggers.length ? ' [' + dish.triggers.join(', ') + ']' : ''), badge: m.badge, badgeClass: m.badgeClass };
  }

  return null;
}

// ‚îÄ‚îÄ‚îÄ Render helpers ‚îÄ‚îÄ‚îÄ
function renderResult(result, query) {
  if (!result) {
    return `<div class="result-card safe">
      <div class="result-icon">‚úÖ</div>
      <div class="result-body">
        <div class="result-title">${escapeHtml(query)} <span class="result-badge badge-safe">Nicht erkannt</span></div>
        <div class="result-detail">Nicht in der Allergiedatenbank gefunden. Trotzdem Zutaten pr√ºfen!</div>
      </div>
    </div>`;
  }
  return `<div class="result-card ${result.level}">
    <div class="result-icon">${result.icon}</div>
    <div class="result-body">
      <div class="result-title">${escapeHtml(result.label)} <span class="result-badge ${result.badgeClass}">${result.badge}</span></div>
      <div class="result-detail">${escapeHtml(result.detail)}</div>
    </div>
  </div>`;
}

function escapeHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

// ‚îÄ‚îÄ‚îÄ Single Input ‚îÄ‚îÄ‚îÄ
let singleDebounce;
document.getElementById('singleInput').addEventListener('input', function() {
  const v = this.value.trim();
  document.getElementById('clearSingle').classList.toggle('show', v.length > 0);
  clearTimeout(singleDebounce);
  singleDebounce = setTimeout(() => {
    const results = document.getElementById('singleResults');
    const empty = document.getElementById('singleEmpty');
    if (!v) { results.innerHTML = ''; empty.style.display = ''; return; }
    empty.style.display = 'none';
    const r = checkIngredient(v);
    results.innerHTML = renderResult(r, v);
  }, 200);
});

// ‚îÄ‚îÄ‚îÄ Multi Input ‚îÄ‚îÄ‚îÄ
let multiDebounce;
document.getElementById('multiInput').addEventListener('input', function() {
  const v = this.value.trim();
  document.getElementById('clearMulti').classList.toggle('show', v.length > 0);
  clearTimeout(multiDebounce);
  multiDebounce = setTimeout(() => {
    const results = document.getElementById('multiResults');
    const empty = document.getElementById('multiEmpty');
    if (!v) { results.innerHTML = ''; empty.style.display = ''; return; }
    empty.style.display = 'none';
    // Split by newlines, commas, semicolons, bullets, "und"/"and"
    const items = v.split(/[\n\r,;‚Ä¢¬∑|]+|\s+und\s+|\s+and\s+/)
      .map(s => s.replace(/^\s*[\d]+[.):\s]*/, '').replace(/^\s*[-‚Äì‚Äî]\s*/, '').trim())
      .filter(s => s.length > 0);
    // Deduplicate (case-insensitive, keep first occurrence)
    const seen = new Set();
    const unique = items.filter(item => {
      const key = item.toLowerCase();
      if (seen.has(key)) return false;
      seen.add(key);
      return true;
    });
    // Sort: deadly first, then dangerous, caution, safe/unknown
    const levelOrder = { deadly: 0, dangerous: 1, caution: 2, safe: 3 };
    const checked = unique.map(item => {
      const r = checkIngredient(item);
      return { item, result: r, order: r ? (levelOrder[r.level] ?? 3) : 3 };
    });
    checked.sort((a, b) => a.order - b.order);
    results.innerHTML = checked.map(c => renderResult(c.result, c.item)).join('');
  }, 300);
});

// ‚îÄ‚îÄ‚îÄ Clear ‚îÄ‚îÄ‚îÄ
function clearInput(type) {
  if (type === 'single') {
    document.getElementById('singleInput').value = '';
    document.getElementById('singleResults').innerHTML = '';
    document.getElementById('singleEmpty').style.display = '';
    document.getElementById('clearSingle').classList.remove('show');
    document.getElementById('singleInput').focus();
  } else {
    document.getElementById('multiInput').value = '';
    document.getElementById('multiResults').innerHTML = '';
    document.getElementById('multiEmpty').style.display = '';
    document.getElementById('clearMulti').classList.remove('show');
    document.getElementById('multiInput').focus();
  }
}

// ‚îÄ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ‚îÄ
function switchTab(id) {
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === id));
  document.querySelectorAll('.tab-content').forEach(t => t.classList.toggle('active', t.id === 'tab-' + id));
}

// ‚îÄ‚îÄ‚îÄ Dishes Grid ‚îÄ‚îÄ‚îÄ
function renderDishes(filter) {
  const grid = document.getElementById('dishesGrid');
  const fq = (filter || '').toLowerCase();
  const levelOrder = { deadly: 0, dangerous: 1, caution: 2, safe: 3 };
  const levelLabels = {
    deadly:    { emoji:'üö®', text:'Lebensgefahr', cls:'badge-deadly' },
    dangerous: { emoji:'‚ö†Ô∏è', text:'Gef√§hrlich', cls:'badge-dangerous' },
    caution:   { emoji:'üòê', text:'Vorsicht', cls:'badge-caution' },
    safe:      { emoji:'‚úÖ', text:'Sicher', cls:'badge-safe' }
  };

  let dishes = DISH_DATABASE;
  if (fq) {
    dishes = dishes.filter(d =>
      d.name.toLowerCase().includes(fq) || d.de.toLowerCase().includes(fq) ||
      d.reason.toLowerCase().includes(fq) || d.triggers.some(t => t.toLowerCase().includes(fq))
    );
  }

  // Group by level
  const groups = {};
  for (const d of dishes) {
    if (!groups[d.level]) groups[d.level] = [];
    groups[d.level].push(d);
  }

  const sectionOrder = ['deadly','dangerous','caution','safe'];
  const sectionTitles = { deadly:'üö® Lebensgefahr', dangerous:'‚ö†Ô∏è Gef√§hrlich', caution:'üòê Vorsicht', safe:'‚úÖ Sicher' };

  let html = '';
  for (const level of sectionOrder) {
    const items = groups[level];
    if (!items || items.length === 0) continue;
    html += `<div class="dish-section"><h3>${sectionTitles[level]}</h3>`;
    for (const d of items) {
      const l = levelLabels[d.level];
      html += `<div class="dish-card" onclick="showDishDetail('${escapeHtml(d.name)}')">
        <div class="dish-name">${escapeHtml(d.de)} <span class="dish-status result-badge ${l.cls}">${l.text}</span></div>
        <div class="dish-detail">${escapeHtml(d.reason)}</div>
      </div>`;
    }
    html += '</div>';
  }

  if (!html) {
    html = '<div class="empty-state"><div class="icon">üçΩÔ∏è</div><p>Kein Gericht gefunden</p></div>';
  }
  grid.innerHTML = html;
}

function showDishDetail(name) {
  // Jump to single check with the dish name
  switchTab('single');
  const input = document.getElementById('singleInput');
  input.value = name;
  input.dispatchEvent(new Event('input'));
}

function filterDishes() {
  const v = document.getElementById('dishSearch').value;
  renderDishes(v);
}

// Init dishes
renderDishes();
</script>
</body>
</html>
